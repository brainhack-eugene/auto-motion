---
title: "compare"
author: "Dani Cosme"
date: "March 3, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

# load packages
```{r}
library(tidyverse)
library(knitr)
```

# define variables
```{r}
# paths
outputDir = '/Volumes/psych-cog/dsnlab/auto-motion-output/'

# variables
study = "tds"
```

# load data
```{r}
# global intensity file created using calculate_global_intensities.R
trash = read.csv(paste0(outputDir,study,'_autoTrash.csv'))

# manually coded file created using manually_coded.R
manual = read.csv(paste0(outputDir,study,'_manuallyCoded.csv'))
```

# compare to manual data
```{r}
# filter trash dataframe and join with filteredMotion
joined = trash %>% 
  left_join(., manual, by = c("subjectID","run","volume")) %>%
  select(subjectID, run, volume, Diff.mean, Diff.sd, trashDiff, trash)

# check false negatives
falseNeg = joined %>% filter(trashDiff == 0 & trash == 1)

# check false positives
falsePos = joined %>% filter(trashDiff == 1 & trash == 0)

# check hits
hits = joined %>% filter(trashDiff == 1 & trash == 1)
```

# summarize results
## print group-level results
```{r}
data.frame(falseNeg = length(falseNeg$trash), falsePos = length(falsePos$trash), hits = length(hits$trash)) %>% knitr::kable(., format = "pandoc")
```

## summarize by participants
```{r}
nVol = joined %>% group_by(subjectID) %>% summarize(nVol = length(volume))
summaryPos = falsePos %>% group_by(subjectID) %>% summarize(falsePos = sum(trashDiff, na.rm=T))
summaryNeg = falseNeg %>% group_by(subjectID) %>% summarize(falseNeg = sum(trash, na.rm=T))
summaryPosNeg = nVol %>%
  full_join(., summaryPos, by = "subjectID") %>% 
  full_join(., summaryNeg, by = "subjectID") %>% 
  mutate(falseNeg = ifelse(is.na(falseNeg), 0, falseNeg), 
         falsePos = ifelse(is.na(falsePos), 0, falsePos), 
         totalErrors = falsePos + falseNeg,
         percentErrors = (totalErrors/nVol)*100)
```

# print subject-level results
```{r}
joined %>% group_by(subjectID) %>% 
  summarise(trashManual = sum(trash, na.rm = T), 
            trashAuto = sum(trashDiff, na.rm = T)) %>%
  full_join(., summaryPosNeg, by = "subjectID") %>%
  select(-nVol) %>%
  arrange(trashManual) %>%
  kable(format = "pandoc", digits = 1)
```
